(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{498:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nps"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://ehang-io.github.io/nps/#/",target:"_blank",rel:"noopener noreferrer"}},[s._v("nps"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("p",[s._v("有时候在公司的业务当中需要固定公网IP将内网业务暴露到公网上或在外网通过ssh连接内网的机器，如果电信、移动或者联通愿意提供固定公网IP的话，只需要在公司内网的某台windows服务器上安装一个端口映射器或安装远程访问下的路由功能（或linux服务器通过防火墙做IP伪装、NAT），然后在公司的出口路由器上将该服务器设置为DMZ主机；但是现在很难从电信、移动或联通那里获得固定公网IP，那么我们可以折衷购买一台云服务器，然后在云服务器上部署内网服务器端口映射。")]),s._v(" "),a("p",[s._v("这里选择NPS来部署，NPS 是一款轻量级、高性能、功能强大的内网穿透代理服务器。")]),s._v(" "),a("ul",[a("li",[s._v("几乎支持所有协议")]),s._v(" "),a("li",[s._v("支持内网http代理、内网socks5代理、p2p等")]),s._v(" "),a("li",[s._v("简洁但功能强大的WEB管理界面")]),s._v(" "),a("li",[s._v("支持服务端、客户端同时控制")]),s._v(" "),a("li",[s._v("扩展功能强大")]),s._v(" "),a("li",[s._v("全平台兼容，一键注册为服务")])]),s._v(" "),a("h2",{attrs:{id:"入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#入门"}},[s._v("#")]),s._v(" 入门")]),s._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("官网上介绍了三种安装方式（安装包安装、源码安装、docker安装），此处仅以安装包安装在CentOS环境下部署为例，想要了解更多内容还请通过官方文档进行学习。")]),s._v(" "),a("ol",[a("li",[s._v("通过官方"),a("a",{attrs:{href:"https://github.com/ehang-io/nps/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("releases"),a("OutboundLink")],1),s._v("下载对应的系统版本即可，服务端和客户端是单独的")]),s._v(" "),a("li",[s._v("服务端安装")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 依赖：golang")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" golang\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建安装目录，并进入安装目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /opt/nps "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/nps\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过wget工具拉取安装包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_server.tar.gz\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压安装包的GZIP方式的压缩包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxvf linux_amd64_server.tar.gz\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行安装程序")]),s._v("\n./nps "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("客户端安装")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" golang\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" ~/opt/local/npc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/opt/local/npc\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" https://github.com/ehang-io/nps/releases/download/v0.26.10/xxx.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxvf xxx.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./npc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"配置-启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-启动"}},[s._v("#")]),s._v(" 配置 && 启动")]),s._v(" "),a("br"),s._v("\n**统一准备工作（必做）**\n"),a("ol",[a("li",[s._v("开启服务端，假设公网服务器ip为1.1.1.1，配置文件中bridge_port为8024，配置文件中web_port为8080")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在生产环境中需要防火墙保护，而在演示环境中，选择关闭所有防火墙")]),s._v("\nsystemctl stop iptables.service\nsystemctl stop firewalld.service\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置文件位置: /etc/nps/conf/nps.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改web访问账户密码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# default: admin / 123")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/web_username=admin/web_username=新用户名/g"')]),s._v(" /etc/nps/conf/nps.conf \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/web_password=123/web_password=新密码/g"')]),s._v(" /etc/nps/conf/nps.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\nnps start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("配置云服务的策略组(开放端口8024、8080、以及预留将来的映射端口)")]),s._v(" "),a("li",[s._v("web访问1.1.1.1:8080")]),s._v(" "),a("li",[s._v("在客户端管理中创建一个客户端，记录下验证密钥")]),s._v(" "),a("li",[s._v("内网客户端运行")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" ~/opt/local/npc/nohup "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/opt/local/npc/nohup\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" npc "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-server")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1.1:8024 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-vkey")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("客户端的密钥 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nohup.out "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[s._v("注意"),a("br"),s._v("\n运行服务端后，请确保能从客户端设备上正常访问配置文件中所配置的bridge_port端口，telnet，netcat这类的来检查")])]),a("br"),s._v(" "),a("p",[a("strong",[s._v("TCP隧道")])]),s._v(" "),a("p",[a("strong",[s._v("适用范围")]),s._v("： ssh、远程桌面等tcp连接场景")]),s._v(" "),a("p",[a("strong",[s._v("假设场景")]),s._v("： 想通过访问公网服务器1.1.1.1的8001端口，连接内网机器10.1.50.101的22端口，实现ssh连接")]),s._v(" "),a("p",[a("strong",[s._v("使用步骤")])]),s._v(" "),a("p",[s._v("在刚才创建的客户端隧道管理中添加一条tcp隧道，填写监听的端口（8001）、内网目标ip和目标端口（10.1.50.101:22），保存。\n访问公网服务器ip（1.1.1.1）,填写的监听端口(8001)，相当于访问内网ip(10.1.50.101):目标端口(22)")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 示例")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v(" root@1.1.1.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);